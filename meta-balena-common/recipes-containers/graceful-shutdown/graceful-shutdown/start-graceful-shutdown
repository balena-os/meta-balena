#!/bin/sh

set -e

GRACEFUL_SHUTDOWN_IMAGE="graceful-shutdown-test:latest"
GRACEFUL_SHUTDOWN_CONTAINER="graceful_shutdown_test"

# Build the Docker image
echo "Building graceful-shutdown test image..."
balena build /usr/lib/graceful-shutdown/ -t "${GRACEFUL_SHUTDOWN_IMAGE}"

# Remove existing container if present
balena rm -f "${GRACEFUL_SHUTDOWN_CONTAINER}" 2>/dev/null || true

# Run the container
echo "Starting graceful-shutdown test container..."
balena run \
    --name "${GRACEFUL_SHUTDOWN_CONTAINER}" \
    --rm \
    "${GRACEFUL_SHUTDOWN_IMAGE}"

